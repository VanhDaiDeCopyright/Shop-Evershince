!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="04bdcb2d-a295-4466-ae5c-1cd25b6018e9",e._sentryDebugIdIdentifier="sentry-dbid-04bdcb2d-a295-4466-ae5c-1cd25b6018e9")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{92651:function(e,t,a){a.d(t,{f:function(){return N}});var n=a(74512),r=a(32735),i=a(82070),o=a.n(i),l=a(46582),c=a.n(l),s=a(35837),d=a(40841),u=a.n(d),p=a(22868),h=a(19655),g=a(14048),m=a(59736),v=a(90124),f=a(50362),y=a(72943),b=a(69289),w=a(88315),R=a(78807),P=a(69122),T=a(79692);let I=e=>{var t,a;let{product:i,currentSize:o,originURL:l,canonicalURL:s,offerURL:d,categoryPathArray:u}=e,p=(0,h.ac)({query:(0,b.PU)("M")}),{formatMessage:g}=(0,v.ve)({name:"product"}),{formatMessage:m}=(0,v.ve)({name:"common"}),[f,y]=(0,r.useState)([""]),w=new Date;w.setDate(w.getDate()+1);let{t:R}=(0,T.$G)("common"),P=()=>{var e;let t=[];return o.images?(null===(e=o.images)||void 0===e||e.map(e=>{e.map(e=>{e.src&&t.push(e.src)})}),t.length<=0)?t:Array.from(new Set(t)):t};(0,r.useEffect)(()=>{let e=P();e.length>0&&y(e.map(e=>'"'.concat(e,'"')))},[o.sku]);let I=(0,r.useMemo)(()=>{let e=!p,t=Array.from(u).slice(-3);return e?t:u},[u,p]);return(0,n.jsx)(n.Fragment,{children:u&&(0,n.jsxs)(c(),{children:[(0,n.jsx)("script",{type:"application/ld+json",children:'{\n              "@context": "http://schema.org",\n              "@type": "BreadcrumbList",\n              "itemListElement": [\n                '.concat(I.map((e,t)=>{var a,n,r,o;return 0===t?'{\n                      "@type": "ListItem",\n                      "position": 1,\n                      "item": {\n                        "@id": "'.concat(l,'/",\n                        "name": "').concat(R("homepage"),'"\n                      }\n                    },{\n                      "@type": "ListItem",\n                      "position": 2,\n                      "item": {\n                        "@id": "').concat(l,"/").concat(e.path,'",\n                        "name": "').concat(null!==(n=null==i?void 0:null===(a=i.categories.find(t=>t.path==="/".concat(e.path)))||void 0===a?void 0:a.name)&&void 0!==n?n:e.name,'"\n                      }\n                    }'):'{\n                    "@type": "ListItem",\n                    "position": '.concat(t+2,',\n                    "item": {\n                      "@id": "').concat(l,"/").concat(e.path,'",\n                       "name": "').concat(null!==(o=null==i?void 0:null===(r=i.categories.find(t=>t.path==="/".concat(e.path)))||void 0===r?void 0:r.name)&&void 0!==o?o:e.name,'"\n                    }\n                  }')}),', {\n                    "@type": "ListItem",\n                    "position": ').concat((null==u?void 0:u.length)+2,',\n                    "item": {\n                      "@id": "').concat(l).concat(null==i?void 0:i.url,'",\n                      "name": "').concat((0,v._A)(null==i?void 0:i.name),'"\n                    }\n                  }\n              ]\n            }')}),(0,n.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:'\n              {\n                "@context": "http://schema.org/",\n                "@type": "Product",\n                "name": "'.concat(o.name,'",\n                "description": "').concat(null===(t=o.description)||void 0===t?void 0:t.join(" - "),'",\n                "brand": { "@type": "Brand", "name": "').concat(o.brand,'" },\n                "image": [').concat(f,'],\n                "sku": "').concat(o.sku,'",\n                "color": "').concat(null===(a=o.color)||void 0===a?void 0:a.value,'",\n                "offers": [\n                  {\n                    "@type": "Offer",\n                    "url": "').concat(d,'",\n                    "priceCurrency": "').concat(o.currency,'",\n                    "price": "').concat(o.price.toString(),'",\n                    "availability": "https://schema.org/InStock",\n                    "priceValidUntil": "').concat(w,'",\n                    "seller": {\n                      "@type": "Organization",\n                      "name": "Tom Tailor"\n                    }\n                  }\n                ]\n              }\n            ')}}),(0,n.jsx)("title",{children:(0,v._A)(null==i?void 0:i.name)+" ".concat(m({id:"by"})," ")+o.brand}),(0,n.jsx)("meta",{name:"title",content:(0,v._A)(null==i?void 0:i.name)+" ".concat(m({id:"by"})," ")+o.brand}),(0,n.jsx)("meta",{name:"description",content:(0,v._A)(null==i?void 0:i.name)+" - ".concat(m({id:"for"})," ")+(o.discount&&o.discount!=o.price?o.discount+" "+o.currency+" ".concat(m({id:"insteadOf"})," ")+o.price+" "+o.currency:o.price+" "+o.currency)+" - "+g({id:"productDescriptionText",defaultMessage:"Jetzt bei TOM TAILOR online bestellen! ✓ Kauf auf Rechnung ✓ Kostenloser R\xfcckversand"})}),(0,n.jsx)("meta",{name:"robots",content:"index,follow"}),(0,n.jsx)("meta",{name:"keywords",content:""}),(0,n.jsx)("link",{rel:"canonical",href:s})]})})};var E=a(66482),_=a(96666),k=a(28087);let S=o()(()=>Promise.all([a.e(9356),a.e(9419)]).then(a.bind(a,49419)),{loadableGenerated:{webpack:()=>[49419]},loading:()=>(0,n.jsx)(E.Z,{})}),A=o()(()=>Promise.all([a.e(4578),a.e(5138)]).then(a.bind(a,45138)),{loadableGenerated:{webpack:()=>[45138]},loading:()=>(0,n.jsx)(E.Z,{})}),C=o()(()=>a.e(9975).then(a.bind(a,89975)),{loadableGenerated:{webpack:()=>[89975]},loading:()=>(0,n.jsx)(E.Z,{})}),x=o()(()=>Promise.resolve().then(a.bind(a,99824)),{loadableGenerated:{webpack:()=>[99824]},loading:()=>(0,n.jsx)(E.Z,{})}),j=o()(()=>a.e(5175).then(a.bind(a,85175)),{loadableGenerated:{webpack:()=>[85175]},loading:()=>(0,n.jsx)(E.Z,{})}),D=o()(()=>Promise.resolve().then(a.bind(a,37070)),{loadableGenerated:{webpack:()=>[37070]},loading:()=>(0,n.jsx)(E.Z,{})}),N=e=>{var t,a,i,o,l,d,T;let{product:E,sizeTableLink:N,careIconsMedia:K,sizeTable:O=[],deliveryPaymentInformation:L,exclusionList:z=[],breadcrumbEntries:M=[],showSaleCountdown:F,productDescription:B,breadcrumbCategoryId:U,inPlp:H=!1,hideComponent:G=!1}=e,q=(0,h.ac)({query:(0,b.PU)("M")}),J=(0,h.ac)({query:(0,b.PU)("L")}),W=(0,g.V)(),Z=new R.L,[V,X]=(0,r.useState)({}),{forceSetStack:Y,constructFromPath:$}=(0,P.b5)(),Q=(0,r.useMemo)(()=>{if(!H){let e=!q,t=M.slice(-3);return e?t:M}},[M,q]),ee=(0,s.useRouter)(),{defaultLocale:et="de_DE",locale:ea=et}=ee,en=2===ea.length?"".concat(ea,"_CH"):ea,[er,ei]=(0,r.useState)({}),[eo,el]=(0,r.useState)({...E}),[ec,es]=(0,r.useState)(!1),[ed,eu]=(0,r.useState)(eo.sizes[0]),[ep,eh]=(0,r.useState)(),[eg,em]=(0,r.useState)(""),[ev,ef]=(0,r.useState)(""),[ey,eb]=(0,r.useState)(""),[ew,eR]=(0,r.useState)(""),[eP,eT]=(0,r.useState)(!1),eI=new Date;eI.setDate(eI.getDate()+1);let eE=(e,t)=>{eu(e),!J&&t&&eD(e)},e_=eo.attributes,ek=async()=>{if(E.referenceKey&&!ek.hasOwnProperty(E.referenceKey))try{let e={},t=[...E.variants,{referenceKey:E.referenceKey}];await Promise.all(t.map(async t=>{let a=t.referenceKey||null;if(null!==a)try{let t=await Z.getCachedProductBySku(a,en);t&&(e[a]=t)}catch(e){console.error("Error fetching data for variant with referenceKey ".concat(a,":"),e)}})),0!==Object.keys(e).length&&ei(e)}catch(e){console.error("TT-ERR: fetching cache data for all variants:",e)}};(0,r.useEffect)(()=>{var e;let t=eo.sizes[0],a={id:"placeholder",images:t.images,image:t.image,color:t.color,currency:t.currency,discount:E.priceRange.min.withTax/100,midDiscountedPrice:t.midDiscountedPrice,price:(0,y.MP)(E.priceRange),priceWithoutTax:E.priceRange.min.withoutTax,pack:t.pack,name:t.name,description:t.description,benefitsDescription:t.benefitsDescription,passForm:t.passForm,materials:t.materials,sustainability:t.sustainability,longSustainability:t.longSustainability,textPhotoModel:t.textPhotoModel,flags:(0,y.UI)(eo.priceRange,eo.sizes),sku:t.sku,brand:t.brand,careIcons:t.careIcons,inlineNumber:t.inlineNumber,groupNumber:t.groupNumber};eE(a);let n=e=>{let{inlineNumber:t,groupNumber:a}=e;return z.some(e=>{let{productGroup:n,productLine:r}=e;return Number(t)===r&&Number(a)===n})};if(eh((()=>{let e=[],t=[],r=!!z.length&&n(a);try{if(!r&&O)return O.map(n=>{0===n.sizeTableGroup.length&&n.tableTitle&&n.tableJson&&Object.keys(n.tableJson).length>0&&t.push({title:n.tableTitle,data:JSON.parse(n.tableJson)}),n.sizeTableGroup.map(t=>{Number(a.inlineNumber)===t.productLine&&Number(a.groupNumber)===t.productGroup&&n.tableJson&&n.tableTitle&&Object.keys(n.tableJson).length>0&&e.push({title:n.tableTitle,data:JSON.parse(n.tableJson)})})}),e.length>0&&eT(!0),e.length>0?e:t.length>0?t:null;return null}catch(e){return null}})()),!eo.productId)return;_.j.setState({pdpProduct:eo});let r=JSON.parse(null!==(e=localStorage.getItem(m.uf.LSHOWN))&&void 0!==e?e:"[]").slice(0,30);r.includes(eo.productId)||r.unshift(eo.productId),localStorage.setItem(m.uf.LSHOWN,JSON.stringify(r));let i=window.location.origin+window.location.pathname;ef(eo.referenceKey.replace("_-_","####").split("_").slice(1).reduce((e,t)=>e.replaceAll("_".concat(t),""),i).replace("####","_-_")),em(window.location.origin),eb(window.location.href);let o=()=>{_.j.setState({returnBackFromPDP:!0});let e=window.history.state;if(!(null==e?void 0:e.url))return;let[t,a]=e.url.split("?");if(!a)return;let n=new URLSearchParams(a);n.has("abpid")&&n.has("show_product")&&(n.delete("show_product"),ee.replace("".concat(t,"?").concat(n.toString()),void 0,{scroll:!1}))};return window.addEventListener("popstate",o),U&&sessionStorage.setItem(m.Hw.BREADCRUMB_CATEGORY_ID,U),ek(),()=>{_.j.setState({pdpProduct:null}),sessionStorage.removeItem(m.Hw.BREADCRUMB_CATEGORY_ID),window.removeEventListener("popstate",o)}},[eo]),(0,r.useEffect)(()=>{ek()},[]),(0,r.useEffect)(()=>{el({...E}),(async()=>{try{if(eo.referenceKey){let e=await (0,w.$)(eo.referenceKey);e&&X({...e})}}catch(e){console.error("TT-ERR: Error in fetching product locales: ".concat(e))}})()},[ee.asPath]);let{formatMessage:eS}=(0,v.ve)({name:"product"}),{formatMessage:eA}=(0,v.ve)({name:"wishlist"}),eC=(0,P.y0)("cart"),ex=null!==(T=null===(i=eC.data)||void 0===i?void 0:null===(a=i.lineItems)||void 0===a?void 0:null===(t=a.find(e=>{var t;return(null===(t=e.variant)||void 0===t?void 0:t.id)==ed.id}))||void 0===t?void 0:t.count)&&void 0!==T?T:0,ej=Math.min(ed.stock,m.B0),eD=e=>{var t,a,r,i,o,l,c,s,d,u,h,g,v,y,b,w,R,P,T;e=e||ed;let I=null!==(y=null===(r=eC.data)||void 0===r?void 0:null===(a=r.lineItems)||void 0===a?void 0:null===(t=a.find(t=>{var a;return(null===(a=t.variant)||void 0===a?void 0:a.id)==e.id}))||void 0===t?void 0:t.count)&&void 0!==y?y:0,E=Math.min(e.stock,m.B0);if(!e.id||"placeholder"===e.id||I>=E)return;null===(i=eC.addItem)||void 0===i||i.call(eC,{productId:e.id.toString()},1);let _=eS({id:"itemAdded",defaultMessage:"Artikel zum Warenkorb hinzugef\xfcgt"});if(eK)(0,p.ZP)(_,{id:"addedCart".concat(eo.productId)});else{let e=eS({id:"itemAddedLoginInfo",defaultMessage:"Jetzt anmelden und Artikel dauerhaft speichern"});p.ZP.custom((0,n.jsxs)("div",{className:"toaster--default",children:[_,(0,n.jsxs)("div",{className:"toaster__subtext",children:[(0,n.jsx)(k.default,{name:"info",modifierClassNames:"toaster__icon"}),e]})]}),{id:"addedCart".concat(eo.productId)})}eu(e),(0,f.sg)({item_referenceKey:eo.referenceKey,EAN:eo.EAN,item_id:eo.productId,item_name:eo.name,brand:e.brand,item_categories:M.map(e=>e.name),currency:e.currency,price:e.price,priceOrg:e.price,priceDiscount:e.discount,location:"Product detail page",size:e.label,stock:e.stock,image:e.image,colorCode:null===(o=eo.referenceKey)||void 0===o?void 0:o.split("_")[1],quantity:1,basket_id:null!==(b=W.basketId)&&void 0!==b?b:"",item_variant:null!==(w=null===(c=eo.attributes)||void 0===c?void 0:null===(l=c.suchFarbeTTShopFarbname[0])||void 0===l?void 0:l.value)&&void 0!==w?w:"",productLine:eo.inlineNumber,productLineName:null!==(R=null===(d=eo.attributes)||void 0===d?void 0:null===(s=d.brand2[0])||void 0===s?void 0:s.label)&&void 0!==R?R:"",productGroup:eo.groupNumber,productGroupName:null!==(P=null===(g=eo.attributes)||void 0===g?void 0:null===(h=g.produktgruppe)||void 0===h?void 0:null===(u=h[0])||void 0===u?void 0:u.label)&&void 0!==P?P:"",firstLiveAt:eo.firstLiveAt,isNew:eo.isNew,breadcrumbPrimaryCategory:null!==(T=null===(v=M[M.length-1])||void 0===v?void 0:v.path)&&void 0!==T?T:""})},eN=(0,P.y0)("wishlist"),eK=!!(0,P.y0)("account").accountData,eO=null===(l=eN.data)||void 0===l?void 0:null===(o=l.lineItems)||void 0===o?void 0:o.find(e=>e.productId==eo.productId),eL=()=>{var e,t,a,r;if(eo){if(eO)(0,p.ZP)(eA({id:"removed",defaultMessage:"Artikel von der Merkliste entfernt"})),null===(a=eN.removeFromWishlist)||void 0===a||a.call(eN,{itemKey:eO.lineItemId}),(0,f.QQ)("".concat((0,b.kC)(null===(r=eo.masterCategoryPath)||void 0===r?void 0:r.split("/").find(e=>!!e)),"::").concat(eo.name));else{let a=eA({id:"added",defaultMessage:"Auf die Merkliste gesetzt"});if(eK)(0,p.ZP)(a,{id:"addedWishlist".concat(eo.productId)});else{let e=eA({id:"loginInfo",defaultMessage:"Jetzt anmelden und Artikel dauerhaft speichern"});p.ZP.custom((0,n.jsxs)("div",{className:"toaster--default",children:[a,(0,n.jsxs)("div",{className:"toaster__subtext",children:[(0,n.jsx)(k.default,{name:"info",modifierClassNames:"toaster__icon"}),e]})]}),{id:"added".concat(eo.productId)})}null===(e=eN.addToWishlist)||void 0===e||e.call(eN,{productId:eo.productId}),(0,f.y5)("".concat((0,b.kC)(null===(t=eo.masterCategoryPath)||void 0===t?void 0:t.split("/").find(e=>!!e)),"::").concat(eo.name))}}},ez="placeholder"===ed.id||ex>=ej,[eM,eF]=(0,r.useState)({0:!1}),eB=()=>{if(ez){eF({0:!0});return}eD()};return(0,r.useEffect)(()=>{W.basketId&&eR(W.basketId)},[W]),(0,n.jsxs)(n.Fragment,{children:[!H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c(),{children:Object.entries(V).map(e=>{let[t,a]=e;return(0,n.jsx)(r.Fragment,{children:(0,n.jsx)("link",{rel:"alternate",href:"".concat(m.CK[t]).concat(a.productUrl),hrefLang:"en_GB"===t&&"x-default"||t})},t)})}),(0,n.jsx)(I,{product:eo,currentSize:ed,originURL:eg,canonicalURL:ev,categoryPathArray:M,offerURL:ey})]}),!G&&(0,n.jsx)("div",{id:"saiz-widget-container","data-lang":m.E4[en],"data-brandcode":"TomTailor","data-productcode":eo.referenceKey,"data-visitorid":ew}),(0,n.jsxs)("div",{className:"pdp",children:[!H&&(0,n.jsx)(j,{className:"pdp__breadcrumb pdp__breadcrumb--v1",seperatorAsText:!0,children:null==Q?void 0:Q.map(e=>{var t,a;return(0,n.jsx)("div",{children:(0,n.jsx)(D,{text:null!==(a=null===(t=eo.categories.find(t=>t.path==="/".concat(e.path)))||void 0===t?void 0:t.name)&&void 0!==a?a:e.name,href:e.path,noUnderline:!0,as:"small",onClick:()=>{Y($(e.path))}})},e.path)})}),(0,n.jsxs)("div",{className:H?"":u()("pdp__flex"),children:[(0,n.jsx)(A,{product:{...eo,...ed},className:"pdp__gallery",onAddToCart:eB,onAddToWishlist:eL,wishlisted:!!eO,addToCartDisabled:ez,showSaleCountdown:F,inPlp:H}),(0,n.jsx)(C,{product:{...eo,...ed},currentSize:ed,selectSize:eE,sizeSelected:ec,setSizeSelected:es,className:"pdp__info",onAddToCart:eB,onAddToWishlist:eL,wishlisted:!!eO,sizeTableLink:eP?void 0:N,addToCartDisabled:ez,attemptWhileDisabled:eM,sizeTableData:ep,onVariantSelect:(e,t)=>{if(H){let t=ee.asPath.split("?");ee.replace("".concat(t[0],"?abpid=").concat(e,"&show_product=true"))}else es(!1),e&&e in er&&el({...er[e]}),ee.replace({pathname:t},void 0,{scroll:!1})},showSaleCountdown:F,pageType:"pdp",inPlp:H})]}),!H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S,{currentSize:ed,careIconsMedia:K,referenceKey:null===(d=eo.referenceKey)||void 0===d?void 0:d.split("_")[0],deliveryPaymentInformation:L,productDescription:B,productAttributes:e_}),ed.benefitsDescription&&(0,n.jsx)(x,{headline:eS({id:"whyWeLove",defaultMessage:"Warum wir diesen Artikel lieben"}),text:ed.benefitsDescription,className:"pdp__benefits"})]})]})]})}},57591:function(e,t,a){a.d(t,{b:function(){return l}});var n=a(69122),r=a(35837),i=a(32735);let o={de:["neu","sale","basics","highlights","nachhaltigere-mode","nachhaltigere-styles"],en:["new","sale","basics","highlights","more-sustainable-fashion","more-sustainable-styles"],fr:["nouveautes","soldes","basiques","highlights","la-mode-plus-durable","des-styles-plus-durables"],nl:["nieuw","sale","basics","highlights","duurzamere-mode","duurzamere-stijlen"],pl:["nowy","sale","basics","highlights","bardziej-zrownowazona-moda","bardziej-zr\xf3wnoważone-styles"]},l=e=>{let{categories:t,category:a,trackingLocale:l="de_DE"}=null!=e?e:{},[c,s]=(0,i.useState)(),d=(0,n.y0)("product"),{locale:u}=(0,r.useRouter)(),p=(0,i.useMemo)(()=>(null==u?void 0:u.includes("_"))?u.split("_")[0]:(null==u?void 0:u.length)===2?u:"de",[u]),h=(0,i.useMemo)(()=>{if("undefined"!=typeof sessionStorage)return sessionStorage.getItem("lastListingCategoryId")},[]),g=(0,i.useMemo)(()=>{if(t)return t.map(e=>{if(!e.path)return{...e,isValid:!1};let t=e.path.split("/"),a=0===t.filter(e=>o[p].includes(e)).length,n=t.length;return{...e,pathArray:t,isValid:a,depth:n}}).filter(e=>e.isValid).sort((e,t)=>e.depth&&e.categoryId?t.depth&&t.categoryId?e.depth===t.depth?parseInt(e.categoryId)-parseInt(t.categoryId):t.depth-e.depth:-1:1)[0]},[t]),m=(0,i.useMemo)(()=>null==t?void 0:t.find(e=>{var t,a;return!((null!==(a=null===(t=e.path)||void 0===t?void 0:t.split("/").length)&&void 0!==a?a:0)<=2)&&e.categoryId===h}),[t,h]),v=(0,i.useMemo)(()=>{var e;return null!==(e=null!=a?a:m)&&void 0!==e?e:g},[a,m,g]),f=(0,i.useMemo)(()=>u===l?null!=a?a:g:c,[u,l,a,g,c]);return(0,i.useEffect)(()=>{var e;let t=null===(e=null!=a?a:g)||void 0===e?void 0:e.categoryId;u!==l&&t&&d.queryCategories({parentId:t,translatedLocale:l}).then(e=>{e&&1===e.length&&s(e[0])})},[a,g,u,l]),{breadcrumbCategory:v,trackingCategory:f,transformToPathArray:e=>(null==e?void 0:e.path)?e.path.split("/").filter(e=>""!==e).map((e,t,a)=>({name:e,path:a.filter((e,a)=>a<=t).join("/")})):[],transformToTrackingPath:e=>e.path?e.path.split("/").filter(e=>""!==e).join(" > "):""}}},78807:function(e,t,a){a.d(t,{L:function(){return P}});var n=a(93686),r=a(79465),i=a(59736),o=a(26537),l=a(13158);class c{async getAllCampaigns(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;try{let a=((0,o.y)(),"".concat("https://tomt-live.storefront.api.scayle.cloud/v1/")),r=new n.is({host:a||"",shopId:t||1501,auth:{type:"token",token:l.env.BAPI_AUTH_TOKEN||""}});return await r.campaigns.get({sort:{by:n.S3.StartAt,direction:n.hS.Descending},pagination:{page:e,perPage:10}})}catch(e){return console.log("TT-ERROR: campaign:getAllCampaigns failed. ".concat(e)),null}}getActiveCampaignDetail(e){let t=new Date().getTime(),a=null;for(let n of e)if(n.start_at&&n.end_at){let e=new Date(n.start_at).getTime(),r=new Date(n.end_at).getTime();t>=e&&t<r&&(!a||n.start_at&&a.start_at&&new Date(n.start_at)>new Date(a.start_at))&&(a=n)}return a}async getStoreFrontCampaignDetail(e){var t;let a=1;if(!e)return null;let n=await this.getAllCampaigns(a,e);if(!n||!(null===(t=n.pagination)||void 0===t?void 0:t.last))return null;let r=n.pagination.last,i=n.entities;for(;a<=r;){let{entities:e,pagination:t}=n;i.push(...e);let o=this.getActiveCampaignDetail(i);if(o)return o;r=t.last,a++}return null}}let s=async e=>{var t;let a=null!==(t=i.M5[e])&&void 0!==t?t:1501;try{let e=new P;return(await e.getKey("campaignKeys"))["".concat(a)]}catch(t){let e=new c;return await e.getStoreFrontCampaignDetail(a)}};var d=a(84919);class u{}u.deepEncode=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e=>{if("string"==typeof e)try{return t?decodeURI(e):encodeURI(e)}catch(t){return console.error("TT-ERR: error on encode/decode with value: ===>".concat(JSON.stringify(e),"<==="),t),e}else if(Array.isArray(e))return e.map(e=>a(e));else if("object"==typeof e)return n(e);else return e},n=e=>{let t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=a(e[n]));return t};return n(e)},u.mappingDetailProductStateToTileProductState=(e,t,a)=>{if(e.sizes&&e.sizes.length){let n=e.sizes[0],r=n.images;r&&r.length>1&&(n.showImages=u.sortImagesByGivenOrder(r,t),n.hoverImages=u.sortImagesByGivenOrder(r,a).flat(),n.images=[...n.showImages,n.hoverImages]),e.sizes=[n]}return e},u.sortImagesByGivenOrder=function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=t.split(",").map(Number),r=e.flat().sort((e,t)=>{var a,r;let i=n.indexOf(null!==(a=e.number)&&void 0!==a?a:1/0),o=n.indexOf(null!==(r=t.number)&&void 0!==r?r:1/0);return -1===i&&-1===o?0:-1===i?1:-1===o?-1:i-o});return a?[[r[0]]]:[r]};let p={stockWithPrice:{productStateAttribute:"sizes",singleCacheKey:"stock",withOptions:{attributes:"all",advancedAttributes:"all",variants:{attributes:{withKey:["stock","size"]}},priceRange:!0,siblings:{attributes:"all",advancedAttributes:{withKey:["eineFarbeFarbnummerHEX"]},images:"all"}}},priceRange:{productStateAttribute:"priceRange",withOptions:{priceRange:!0}}},h={attributes:"all",advancedAttributes:"all",variants:{attributes:{withKey:["color","size"]},advancedAttributes:"all"},images:"all",siblings:{attributes:"all",advancedAttributes:{withKey:["eineFarbeFarbnummerHEX"]},images:"all"},categories:"all",baseCategories:!0,priceRange:!0};var g=a(65465);let m=e=>e.filter(e=>void 0!==e.variantId).map(e=>({variantId:e.variantId,stock:e.stock})),v=e=>{var t,a,n;let r={...e},i=null!==(t=e.stock)&&void 0!==t?t:null,o=null!==(a=e.variantPrices)&&void 0!==a?a:null,l=null!==(n=e.variantsFlags)&&void 0!==n?n:null;return r.sizes=r.sizes.map(e=>{let t={...e};if(i){let a=i.find(t=>t.variantId===e.variantId);a&&(t={...t,stock:a.stock})}if(l){let a=l.find(t=>t.variantId===e.variantId);a&&(t={...t,flags:a.flags})}if(o){let a=o.find(t=>t.variantId===e.variantId);if(a){let e=0,n=0;a.campaignPrice&&a.salePrice?(e=a.campaignPrice,n=a.salePrice):a.campaignPrice?e=a.campaignPrice:a.salePrice&&(e=a.salePrice),t={...t,price:a.totalPrice,discount:e,midDiscountedPrice:n}}}return t}),delete r.stock,delete r.variantPrices,r},f=(e,t)=>null==e?void 0:e.sizes.filter(e=>void 0!==e.variantId).map(a=>{var n,r,i,o,l,c,s;let d=0,u=0;return t?(d=null!==(l=null==a?void 0:a.midDiscountedPrice)&&void 0!==l?l:0,u=null!==(c=null==a?void 0:a.discount)&&void 0!==c?c:0):(d=null!==(s=null==a?void 0:a.discount)&&void 0!==s?s:0,u=0),{variantId:null==a?void 0:a.variantId,totalPrice:null==a?void 0:a.price,salePrice:d,campaignPrice:u,maximumPrice:null==e?void 0:null===(r=e.priceRange)||void 0===r?void 0:null===(n=r.max)||void 0===n?void 0:n.withTax,minimumPrice:null==e?void 0:null===(o=e.priceRange)||void 0===o?void 0:null===(i=o.min)||void 0===i?void 0:i.withTax}}),y=(e,t)=>null==e?void 0:e.sizes.filter(e=>void 0!==e.variantId).map(e=>({variantId:null==e?void 0:e.variantId,flags:(0,g.n)(t,null==e?void 0:e.flags)})),b=(e,t,a)=>{let n={},r=m(e.sizes),i=f(e,t),o=y(e,a);return r&&(n.stock=r),i&&(n.variantPrices=i),e.priceRange&&(n.priceRange=e.priceRange),o&&(n.variantsFlags=o),e.variants&&(n.variants=e.variants),n};var w=a(18393),R=a(13158);class P{async getKey(e){try{return await this.redisReadClient.get(e)}catch(e){throw Error("TT-ERROR: redis:getKey failed. ".concat(e))}}async fetchAndCacheSingleProductByReferenceKeyForLocale(e,t,a){if(!e)return 0;try{let n=2===t.length?"".concat(t,"_CH"):t,r=this.getBapiClient(n),i=await r.products.getByReferenceKey(e,{with:h,campaignKey:a});if(i){let e=this.mapProduct([i]);return this.cacheProduct(e,n,null!=a?a:null).then(),1}return 0}catch(t){throw console.error("TT-ERR: Redis error on caching product with referenceKey: ".concat(e),t),Error("TT-ERR: Error in fetchAndCacheSingleProductByReferenceKeyForLocale: ".concat(t))}}async handleCacheRequest(e){try{return await this.fetchAndCacheProductsForLocale(e)}catch(e){throw console.warn("TT-ERR: Redis error on handleCacheRequest",e),Error("TT-ERR: Error in handleCacheRequest: ".concat(e))}}async handleUpdateRequest(e,t){try{return await this.fetchAndUpdateProductAttributesForLocale(e,t)}catch(e){throw console.warn("TT-ERR: Redis error on handleCacheRequest",e),Error("TT-ERR: Error in handleCacheRequest: ".concat(e))}}async fetchAndCacheProductsForLocale(e){try{var t,a;let n=[],r=await s(e),i=null;r&&"object"==typeof r&&null!=r.key&&(i=null!==(t=r.key)&&void 0!==t?t:r.key);let o=this.getBapiClient(e),{entities:l,pagination:c}=await o.products.query({with:h,pagination:{perPage:200},...i?{campaignKey:i}:{}});for(n.push(...this.mapProduct(l)),n&&await this.cacheProduct(n,e,i),n=[];c.page<=c.last;)({entities:l,pagination:c}=await o.products.query({with:h,pagination:{perPage:200,page:c.page+1},...i?{campaignKey:i}:{}})),l&&(n.push(...this.mapProduct(l)),n&&await this.cacheProduct(n,e,i),n=[]);return null!==(a=c.total)&&void 0!==a?a:0}catch(e){throw console.warn("TT-ERR: Redis error on caching products",e),Error("TT-ERR: Error in fetchAndCacheProductsForLocale: ".concat(e))}}async fetchAndUpdateProductAttributesForLocale(e,t){try{var a,r;let o=[],l=h;t&&p.hasOwnProperty(t)&&p[t].withOptions&&(l=p[t].withOptions);let c={with:l,pagination:{perPage:200}},d=await s(e),u=null;d&&"object"==typeof d&&null!=d.key&&(u=null!==(a=d.key)&&void 0!==a?a:d.key).length>0&&(c.campaignKey=u);let g=new n.is({host:"https://tomt-live.storefront.api.scayle.cloud/v1/",shopId:i.M5[e]||1501,auth:{type:"token",token:R.env.BAPI_AUTH_TOKEN||""}}),{entities:m,pagination:v}=await g.products.query({...c});for(o.push(...this.mapProduct(m)),o&&o.length&&await this.cacheProductAttributes(o,e,t,u),o=[];v.page<=v.last;)({entities:m,pagination:v}=await g.products.query({...c,pagination:{...c.pagination,page:v.page+1}})),m&&(o.push(...this.mapProduct(m)),o&&o.length&&await this.cacheProductAttributes(o,e,t,u),o=[]);return null!==(r=v.total)&&void 0!==r?r:0}catch(e){throw console.warn("TT-ERR: Redis error on caching products",e),Error("TT-ERR: Error in fetchAndCacheProductsForLocale: ".concat(e))}}mapProduct(e){let t=[];return e.forEach(e=>{let a=d.C6.bapiProductToTomTailorProduct(e,{getAllVariants:!0});t.push(d.V5.transform(a))}),t}getBapiClient(e){return new n.is({host:"https://tomt-live.storefront.api.scayle.cloud/v1/",shopId:i.M5[e]||1501,auth:{type:"token",token:R.env.BAPI_AUTH_TOKEN||""}})}constructor(){var e=this;this.REDIS_KEY_EXPIRATION_SECONDS=86400,this.setKey=async(e,t)=>{try{if(!e||!t)return{message:"Key or value is missing."};let a=new r.s(w.X);return await a.set(e,t),{message:"Key updated successfully"}}catch(e){throw Error("TT-ERROR: redis:setKey failed. ".concat(e))}},this.getProductLocales=async e=>{try{let t=["url"],a={},n=this.locales.map(async n=>{let r=this.getRedisHash(e,n),i=this.redisReadClient.pipeline();for(let e of t)i.hget(r,e);let o=(await i.exec())[0];o&&(a[n]={productUrl:o})});return await Promise.all(n),a}catch(e){throw console.warn("TT-ERR: Redis error on getProductLocales",e),Error("TT-ERR: Error in getProductLocales: ".concat(e))}},this.getCachedProductBySku=async(e,t)=>{let a=2===t.length?"".concat(t,"_CH"):t,n=this.getRedisHash(e,a),r=await this.redisReadClient.hgetall(n);if(r)try{let e=u.deepEncode(r,!0);if(e.stock)return v(e);return e}catch(e){return}},this.getCachedProductBySkus=async function(t,a){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=2===a.length?"".concat(a,"_CH"):a,l=t.length<=500?10:20,c=Math.ceil(t.length/l),s=[];for(let a=0;a<t.length;a+=c){let n=t.slice(a,a+c);s.push(e.createPipelineChunk(n,o))}let p=await Promise.all(s);return n?(r||(r=d.V5.getImageSortOrder()),i||(i=d.V5.getImageSortOrder()),p.flat().filter(e=>null!==e).map(e=>u.deepEncode(e,!0)).map(e=>u.mappingDetailProductStateToTileProductState(e,r,i))):p.map(e=>u.deepEncode(e,!0))},this.createPipelineChunk=async(e,t)=>{let a=this.redisReadClient.pipeline();for(let n of e)if(n){let e="product:".concat(n,":").concat(t);a.hgetall(e)}return await a.exec()},this.cacheProduct=async(e,t,a)=>{try{let n=new r.s(w.X);if(!e.length)return 0;for(let r=0;r<e.length;r+=200){let i=e.slice(r,r+200),o=n.pipeline();for(let e of i){if(!e.referenceKey)continue;let n=this.getRedisHash(e.referenceKey,t),r=u.deepEncode(e),i=Object.fromEntries(Object.entries({...r}).filter(e=>{let[t,a]=e;return null!=a})),l=u.deepEncode(b(e,a,t));o.hset(n,{...i,...l}),o.expire(n,this.REDIS_KEY_EXPIRATION_SECONDS)}await o.exec()}return e.length}catch(e){throw console.warn("TT-ERR: Redis error inside caching products",e),Error("TT-ERR: Error in cacheProduct: ".concat(e))}},this.cacheProductAttributes=async(e,t,a,n)=>{try{if(!p.hasOwnProperty(a))return console.error("TT-ERR: Error in cacheProductAttributes: No correct cacheKey is provided locale: ".concat(t)),0;let i=new r.s(w.X);if(!e.length)return console.error("TT-ERR: Error in cacheProductAttributes: No products found for locale: ".concat(t)),0;for(let a=0;a<e.length;a+=200){let r=e.slice(a,a+200),o=i.pipeline(),l=!1,c={};for(let e of r)if(e.referenceKey){let a=this.getRedisHash(e.referenceKey,t);c=b(e,n,t),Object.keys(c).length>0&&(l=!0,o.hset(a,u.deepEncode(c)),o.expire(a,this.REDIS_KEY_EXPIRATION_SECONDS))}l&&await o.exec()}return e.length}catch(e){throw console.warn("TT-ERR: Redis error inside caching products",e),Error("TT-ERR: Error in cacheProduct: ".concat(e))}},this.getRedisHash=(e,t)=>"".concat("product",":").concat(e.replace(/_-_/g," "),":").concat(t),this.redisReadClient=new r.s(w.h),this.locales=Object.values(i.Kc)}}},88315:function(e,t,a){a.d(t,{$:function(){return r}});var n=a(78807);async function r(e){try{if(!e)return null;let t=new n.L;return await t.getProductLocales(e)}catch(e){return console.log("TT-ERR: Error in getProductLocales: ".concat(e)),null}}}}]);